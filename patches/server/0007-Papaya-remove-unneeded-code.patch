From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: moo <48740106+moom0o@users.noreply.github.com>
Date: Tue, 29 Jun 2021 14:25:31 -0400
Subject: [PATCH] (Papaya) remove unneeded code

Original code by moom0o, licensed under GPLv3
Yoi can find the original code on https://github.com/moom0o/Papaya

diff --git a/src/main/java/me/hungnguyennaz/neonpaper/NeonPaperConfig.java b/src/main/java/me/hungnguyennaz/neonpaper/NeonPaperConfig.java
index 7520fdc06805f51ce945b406778895411174c5b5..dc3922216920984d75aea7d2e05296cd4d7fee59 100644
--- a/src/main/java/me/hungnguyennaz/neonpaper/NeonPaperConfig.java
+++ b/src/main/java/me/hungnguyennaz/neonpaper/NeonPaperConfig.java
@@ -176,7 +176,7 @@ public class NeonPaperConfig {
 
     public static Boolean preventChunksWorldBorder = true;
     private static void preventChunksWorldBorder() {
-        preventChunksWorldBorder = getBoolean("settings.prevent-chunks-generating-past-worldborder-lag-exploit", true);
+        preventChunksWorldBorder = getBoolean("settings.worldborder.prevent-chunks-generating-past-worldborder-lag-exploit", true);
     }
 
 }
diff --git a/src/main/java/net/minecraft/server/ChunkProviderServer.java b/src/main/java/net/minecraft/server/ChunkProviderServer.java
index 3afc01d06794ebdb25c18dfeb3086e48645dbba2..ca89369cec5423786e0446858301e4e6f3fe5626 100644
--- a/src/main/java/net/minecraft/server/ChunkProviderServer.java
+++ b/src/main/java/net/minecraft/server/ChunkProviderServer.java
@@ -4,7 +4,6 @@ import com.destroystokyo.paper.exception.ServerInternalException;
 import it.unimi.dsi.fastutil.longs.Long2ObjectOpenHashMap;
 import it.unimi.dsi.fastutil.longs.LongArraySet;
 import it.unimi.dsi.fastutil.longs.LongIterator;
-import me.hungnguyennaz.neonpaper.NeonPaperConfig;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 import org.bukkit.craftbukkit.chunkio.ChunkIOExecutor;
@@ -105,10 +104,8 @@ public class ChunkProviderServer implements IChunkProvider {
             chunk = this.loadChunk(i, j);
             if (chunk != null) {
                 this.chunks.put(ChunkCoordIntPair.a(i, j), chunk);
-                if(!NeonPaperConfig.preventChunksWorldBorder || (chunk.locX <= 1875000 && chunk.locZ <= 1875000 && chunk.locX >= -1875000 && chunk.locZ >= -1875000)){ // Papaya - Patch retarded lag exploit at world border
-                    chunk.loadNearby(this, this.chunkGenerator, true); // CraftBukkit
-                    chunk.addEntities();
-                }
+                chunk.addEntities();
+                chunk.loadNearby(this, this.chunkGenerator, false); // CraftBukkit
             }
         }
 
@@ -185,11 +182,8 @@ public class ChunkProviderServer implements IChunkProvider {
             }
 
             this.chunks.put(k, chunk);
-
-            if(!NeonPaperConfig.preventChunksWorldBorder || (chunk.locX <= 1875000 && chunk.locZ <= 1875000 && chunk.locX >= -1875000 && chunk.locZ >= -1875000)){ // Papaya - Patch retarded lag exploit at world border
-                chunk.loadNearby(this, this.chunkGenerator, true); // CraftBukkit
-                chunk.addEntities();
-            }
+            chunk.addEntities();
+            chunk.loadNearby(this, this.chunkGenerator, true); // CraftBukkit
             world.timings.syncChunkLoadTimer.stopTiming(); // Spigot
         }
 
diff --git a/src/main/java/net/minecraft/server/PlayerChunk.java b/src/main/java/net/minecraft/server/PlayerChunk.java
index 39dcc3f024371aa894bdfd79058bbd7bde843d26..93725a4001d51013b1e7a1cac08edbf0ce1e9efc 100644
--- a/src/main/java/net/minecraft/server/PlayerChunk.java
+++ b/src/main/java/net/minecraft/server/PlayerChunk.java
@@ -49,14 +49,12 @@ public class PlayerChunk {
     public PlayerChunk(PlayerChunkMap playerchunkmap, int i, int j) {
         this.playerChunkMap = playerchunkmap;
         this.location = new ChunkCoordIntPair(i, j);
-        if(!NeonPaperConfig.preventChunksWorldBorder || (location.x <= 1875000 && location.z <= 1875000 && location.x >= -1875000 && location.z >= -1875000)) { // Papaya - Patch retarded lag exploit at world border
-            // CraftBukkit start
-            loadInProgress = true;
-            this.chunk = playerchunkmap.getWorld().getChunkProviderServer().getChunkAt(i, j, loadedRunnable, false);
-            this.chunkExists = this.chunk != null || ChunkIOExecutor.hasQueuedChunkLoad(playerChunkMap.getWorld(), i, j); // Paper
-            markChunkUsed(); // Paper - delay chunk unloads
-            // CraftBukkit end
-        }
+        // CraftBukkit start
+        loadInProgress = true;
+        this.chunk = playerchunkmap.getWorld().getChunkProviderServer().getChunkAt(i, j, loadedRunnable, false);
+        this.chunkExists = this.chunk != null || ChunkIOExecutor.hasQueuedChunkLoad(playerChunkMap.getWorld(), i, j); // Paper
+        markChunkUsed(); // Paper - delay chunk unloads
+        // CraftBukkit end
     }
 
     public ChunkCoordIntPair a() {
@@ -67,20 +65,21 @@ public class PlayerChunk {
         if (this.c.contains(entityplayer)) {
             PlayerChunk.a.debug("Failed to add player. {} already is in chunk {}, {}", entityplayer, Integer.valueOf(this.location.x), Integer.valueOf(this.location.z));
         } else {
-            if (this.c.isEmpty()) {
-                this.i = this.playerChunkMap.getWorld().getTime();
-            }
+            if(!NeonPaperConfig.preventChunksWorldBorder || (location.x <= 1875000 && location.z <= 1875000 && location.x >= -1875001 && location.z >= -1875001)) { // Papaya - Patch retarded lag exploit at world border
+                if (this.c.isEmpty()) {
+                    this.i = this.playerChunkMap.getWorld().getTime();
+                }
 
-            this.c.add(entityplayer);
-            // CraftBukkit start - use async chunk io
-            // if (this.done) {
-            //     this.sendChunk(entityplayer);
-            // }
-            if (this.done) {
-                this.sendChunk(entityplayer);
+                this.c.add(entityplayer);
+                // CraftBukkit start - use async chunk io
+                // if (this.done) {
+                //     this.sendChunk(entityplayer);
+                // }
+                if (this.done) {
+                    this.sendChunk(entityplayer);
+                }
+                // CraftBukkit end
             }
-            // CraftBukkit end
-
         }
     }
 
diff --git a/src/main/java/org/bukkit/craftbukkit/chunkio/ChunkIOProvider.java b/src/main/java/org/bukkit/craftbukkit/chunkio/ChunkIOProvider.java
index 77d9f63c0c3d70cd5cccfc30254a48c2f1ff1a1f..c7bb07a0b2ffde30057856b1001cbb5da976568d 100644
--- a/src/main/java/org/bukkit/craftbukkit/chunkio/ChunkIOProvider.java
+++ b/src/main/java/org/bukkit/craftbukkit/chunkio/ChunkIOProvider.java
@@ -56,10 +56,7 @@ class ChunkIOProvider implements AsynchronousExecutor.CallBackProvider<QueuedChu
         if (queuedChunk.provider.chunkGenerator != null) {
             queuedChunk.provider.chunkGenerator.recreateStructures(chunk, queuedChunk.x, queuedChunk.z);
         }
-
-        if(!NeonPaperConfig.preventChunksWorldBorder || (chunk.locX <= 1875000 && chunk.locZ <= 1875000 && chunk.locX >= -1875000 && chunk.locZ >= -1875000)){ // Papaya - Patch retarded lag exploit at world border
-            chunk.loadNearby(queuedChunk.provider, queuedChunk.provider.chunkGenerator, false);
-        }
+        chunk.loadNearby(queuedChunk.provider, queuedChunk.provider.chunkGenerator, false);
         } // Paper
     }
 
